!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanillaInternals={})}(this,(function(n){"use strict";function e(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function t(n,t){var r="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(r)return(r=r.call(n)).next.bind(r);if(Array.isArray(n)||(r=function(n,t){if(n){if("string"==typeof n)return e(n,t);var r={}.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(n,t):void 0}}(n))||t){r&&(n=r);var o=0;return function(){return o>=n.length?{done:!0}:{done:!1,value:n[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=function(n,e){return n.unstable_is?n.unstable_is(e):e===n},o=function(n){return"init"in n},a=function(n){return!!n.write},i=function(n){return"v"in n||"e"in n},u=function(n){if("e"in n)throw n.e;return n.v},l=Symbol(),f=function(n){return n[l]},d=function(n){var e;return s(n)&&!(null!=(e=f(n))&&e[1])},v=function(n,e){var t=f(n);t&&(t[1]=!0,t[0].forEach((function(n){return n(e)})))},c=function(n){if(!f(n)){var e=[new Set,!1];n[l]=e;var t=function(){e[1]=!0};n.then(t,t),n.onCancel=function(n){e[0].add(n)}}},s=function(n){return"function"==typeof(null==n?void 0:n.then)},h=function(n,e,t){t.p.has(n)||(t.p.add(n),e.then((function(){t.p.delete(n)}),(function(){t.p.delete(n)})))},y=function(n,e,r){var o=r(n),a="v"in o,i=o.v,u=d(o.v)?o.v:null;if(s(e)){c(e);for(var l,f=t(o.d.keys());!(l=f()).done;){var y=l.value;h(n,e,r(y))}}o.v=e,delete o.e,a&&Object.is(i,o.v)||(++o.n,u&&v(u,e))},g=function(n,e,r){for(var o,a=new Set,i=t((null==(u=r.get(n))?void 0:u.t)||[]);!(o=i()).done;){var u,l=o.value;r.has(l)&&a.add(l)}for(var f,d=t(e.p);!(f=d()).done;){var v=f.value;a.add(v)}return a},p=function(){var n={},e=new WeakMap,t=function(t){var r,o;null==(r=e.get(n))||r.forEach((function(n){return n(t)})),null==(o=e.get(t))||o.forEach((function(n){return n()}))};return t.add=function(t,r){var o=t||n,a=(e.has(o)?e:e.set(o,new Set)).get(o);return a.add(r),function(){null==a||a.delete(r),a.size||e.delete(o)}},t},w=Symbol(),A=function(n,e,l,f,v,c,p,A,m,N,b){void 0===n&&(n=new WeakMap),void 0===e&&(e=new WeakMap),void 0===l&&(l=new WeakMap),void 0===f&&(f=new Set),void 0===v&&(v=new Set),void 0===c&&(c=new Set),void 0===p&&(p={}),void 0===A&&(A=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return n.read.apply(n,t)}),void 0===m&&(m=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return n.write.apply(n,t)}),void 0===N&&(N=function(n,e){return null==n.unstable_onInit?void 0:n.unstable_onInit(e)}),void 0===b&&(b=function(n,e){return null==n.onMount?void 0:n.onMount(e)});var E=(arguments.length<=11?void 0:arguments[11])||function(e){var t=n.get(e);return t||(t={d:new Map,p:new Set,n:0},n.set(e,t),null==N||N(e,z)),t},S=(arguments.length<=12?void 0:arguments[12])||function(){var n,t,r=function(e){try{e()}catch(e){n||(n=!0,t=e)}},o=function(){p.f&&r(p.f);var n=new Set,t=n.add.bind(n);f.forEach((function(n){var r;return null==(r=e.get(n))?void 0:r.l.forEach(t)})),f.clear(),c.forEach(t),c.clear(),v.forEach(t),v.clear(),n.forEach(r),f.size&&I()};do{o()}while(f.size||c.size||v.size);if(n)throw t},I=(arguments.length<=13?void 0:arguments[13])||function(){for(var n=[],r=new WeakSet,o=new WeakSet,a=Array.from(f);a.length;){var i=a[a.length-1],u=E(i);if(o.has(i))a.pop();else if(r.has(i))l.get(i)===u.n&&n.push([i,u]),o.add(i),a.pop();else{r.add(i);for(var d,v=t(g(i,u,e));!(d=v()).done;){var c=d.value;r.has(c)||a.push(c)}}}for(var s=n.length-1;s>=0;--s){for(var h,y=n[s],p=y[0],w=!1,A=t(y[1].d.keys());!(h=A()).done;){var m=h.value;if(m!==p&&f.has(m)){w=!0;break}}w&&(T(p),L(p)),l.delete(p)}},T=(arguments.length<=14?void 0:arguments[14])||function(n){var t=E(n);if(i(t)){if(e.has(n)&&l.get(n)!==t.n)return t;if(Array.from(t.d).every((function(n){var e=n[0],t=n[1];return T(e).n===t})))return t}t.d.clear();var v,c,g=!0,w=function(){e.has(n)&&(L(n),I(),S())},m={get signal(){return v||(v=new AbortController),v.signal},get setSelf(){return!c&&a(n)&&(c=function(){if(!g)try{for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return R.apply(void 0,[n].concat(t))}finally{I(),S()}}),c}},N=t.n;try{var b=A(n,(function(a){if(r(n,a)){var l=E(a);if(!i(l)){if(!o(a))throw new Error("no atom init");y(a,a.init,E)}return u(l)}var f=T(a);try{return u(f)}finally{var v;t.d.set(a,f.n),d(t.v)&&h(n,t.v,f),null==(v=e.get(a))||v.t.add(n),g||w()}}),m);return y(n,b,E),s(b)&&(null==b.onCancel||b.onCancel((function(){var n;return null==(n=v)?void 0:n.abort()})),b.then(w,w)),t}catch(n){return delete t.v,t.e=n,++t.n,t}finally{g=!1,N!==t.n&&l.get(n)===N&&(l.set(n,t.n),f.add(n),null==p.c||p.c(n))}},_=(arguments.length<=15?void 0:arguments[15])||function(n){for(var r=[n];r.length;)for(var o,a=r.pop(),i=E(a),u=t(g(a,i,e));!(o=u()).done;){var f=o.value,d=E(f);l.set(f,d.n),r.push(f)}},R=(arguments.length<=16?void 0:arguments[16])||function(n){var e=!0;try{for(var t=arguments.length,a=new Array(t>1?t-1:0),i=1;i<t;i++)a[i-1]=arguments[i];return m.apply(void 0,[n,function(n){return u(T(n))},function(t){var a=E(t);try{for(var i=arguments.length,u=new Array(i>1?i-1:0),l=1;l<i;l++)u[l-1]=arguments[l];if(r(n,t)){if(!o(t))throw new Error("atom not writable");var d=a.n,v=u[0];return y(t,v,E),L(t),void(d!==a.n&&(f.add(t),null==p.c||p.c(t),_(t)))}return R.apply(void 0,[t].concat(u))}finally{e||(I(),S())}}].concat(a))}finally{e=!1}},L=(arguments.length<=17?void 0:arguments[17])||function(n){var r=E(n),o=e.get(n);if(o&&!d(r.v)){for(var a,i=t(r.d);!(a=i()).done;){var u=a.value,l=u[0],v=u[1];if(!o.d.has(l)){var c=E(l);k(l).t.add(n),o.d.add(l),v!==c.n&&(f.add(l),null==p.c||p.c(l),_(l))}}for(var s,h=t(o.d||[]);!(s=h()).done;){var y=s.value;if(!r.d.has(y)){o.d.delete(y);var g=P(y);null==g||g.t.delete(n)}}}},k=(arguments.length<=18?void 0:arguments[18])||function(n){var r=E(n),o=e.get(n);if(!o){T(n);for(var i,u=t(r.d.keys());!(i=u()).done;){var l=i.value;k(l).t.add(n)}if(o={l:new Set,d:new Set(r.d.keys()),t:new Set},e.set(n,o),null==p.m||p.m(n),a(n)){v.add((function(){var e=!0;try{var t=b(n,(function(){try{for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return R.apply(void 0,[n].concat(r))}finally{e||(I(),S())}}));t&&(o.u=function(){e=!0;try{t()}finally{e=!1}})}finally{e=!1}}))}}return o},P=(arguments.length<=19?void 0:arguments[19])||function(n){var r=E(n),o=e.get(n);if(!o||o.l.size||Array.from(o.t).some((function(t){var r;return null==(r=e.get(t))?void 0:r.d.has(n)})))return o;o.u&&c.add(o.u),o=void 0,e.delete(n),null==p.u||p.u(n);for(var a,i=t(r.d.keys());!(a=i()).done;){var u=a.value,l=P(u);null==l||l.t.delete(n)}},M=[n,e,l,f,v,c,p,A,m,N,b,E,S,I,T,_,R,L,k,P],z={get:function(n){return u(T(n))},set:function(n){try{for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return R.apply(void 0,[n].concat(t))}finally{I(),S()}},sub:function(n,e){var t=k(n).l;return t.add(e),S(),function(){t.delete(e),P(n),S()}}};return Object.defineProperty(z,w,{value:M}),z},m=function(n){return n[w]},N=function(n){var e,t,r,o,a,i;return(e=n).c||(e.c=p()),(t=n).m||(t.m=p()),(r=n).u||(r.u=p()),(o=n).f||(o.f=(a=new Set,(i=function(){a.forEach((function(n){return n()}))}).add=function(n){return a.add(n),function(){a.delete(n)}},i)),n},b=r,E=o,S=a,I=i,T=u,_=f,R=d,L=v,k=c,P=s,M=h,z=y,W=g;n.INTERNAL_addPendingPromiseToDependency=M,n.INTERNAL_buildStoreRev1=A,n.INTERNAL_cancelPromise=L,n.INTERNAL_getBuildingBlocksRev1=m,n.INTERNAL_getMountedOrPendingDependents=W,n.INTERNAL_getPromiseState=_,n.INTERNAL_hasInitialValue=E,n.INTERNAL_initializeStoreHooks=N,n.INTERNAL_isActuallyWritableAtom=S,n.INTERNAL_isAtomStateInitialized=I,n.INTERNAL_isPendingPromise=R,n.INTERNAL_isPromiseLike=P,n.INTERNAL_isSelfAtom=b,n.INTERNAL_patchPromiseForCancelability=k,n.INTERNAL_returnAtomValue=T,n.INTERNAL_setAtomStateValueOrPromise=z}));
